(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1145:(e,s,t)=>{"use strict";t.d(s,{A:()=>i});var a=t(5155),r=t(2115),n=t(5695);function i(e){let{onSuccess:s}=e,[t,i]=(0,r.useState)({usernameOrEmail:"",password:"",rememberMe:!1}),[o,l]=(0,r.useState)({}),[d,m]=(0,r.useState)(!1),c=(0,n.useRouter)(),u=()=>{let e={};return t.usernameOrEmail.trim()||(e.usernameOrEmail="Username or email is required"),t.password||(e.password="Password is required"),l(e),0===Object.keys(e).length},h=async e=>{if(e.preventDefault(),u()){m(!0);try{let e=await fetch("/api/v1/auth/login",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({username:t.usernameOrEmail,password:t.password,scope:t.rememberMe?"remember_me":""})});if(!e.ok){let s=await e.json();throw Error(s.detail||"Login failed")}let{access_token:a}=await e.json();(t.rememberMe?localStorage:sessionStorage).setItem("access_token",a),c.refresh(),s?s():c.push("/")}catch(e){l({submit:e instanceof Error?e.message:"Login failed"})}finally{m(!1)}}},x=e=>{let{name:s,value:t,type:a,checked:r}=e.target;i(e=>({...e,[s]:"checkbox"===a?r:t}))};return(0,a.jsxs)("form",{onSubmit:h,className:"space-y-4",children:[o.submit&&(0,a.jsx)("div",{className:"text-red-500 text-sm",children:o.submit}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"usernameOrEmail",className:"block text-sm font-medium",children:"Username or Email"}),(0,a.jsx)("input",{type:"text",id:"usernameOrEmail",name:"usernameOrEmail",value:t.usernameOrEmail,onChange:x,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"}),o.usernameOrEmail&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-500",children:o.usernameOrEmail})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium",children:"Password"}),(0,a.jsx)("input",{type:"password",id:"password",name:"password",value:t.password,onChange:x,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"}),o.password&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-500",children:o.password})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",id:"rememberMe",name:"rememberMe",checked:t.rememberMe,onChange:x,className:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),(0,a.jsx)("label",{htmlFor:"rememberMe",className:"ml-2 block text-sm",children:"Remember me"})]}),(0,a.jsx)("button",{type:"submit",disabled:d,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50",children:d?"Logging in...":"Login"})]})}},4048:(e,s,t)=>{Promise.resolve().then(t.bind(t,8937))},4274:(e,s,t)=>{"use strict";t.d(s,{J:()=>o,v:()=>i});var a=t(5155),r=t(2115);let n=(0,r.createContext)(void 0);function i(e){let{children:s,user:t}=e;return(0,a.jsx)(n.Provider,{value:{user:t},children:s})}function o(){let e=(0,r.useContext)(n);if(void 0===e)throw Error("useUser must be used within a UserProvider");return e}},5695:(e,s,t)=>{"use strict";var a=t(8999);t.o(a,"useRouter")&&t.d(s,{useRouter:function(){return a.useRouter}})},8937:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>m});var a=t(5155),r=t(2115);function n(e){let{parentId:s,onSuccess:t}=e,[n,i]=(0,r.useState)(""),[o,l]=(0,r.useState)(!1),[d,m]=(0,r.useState)(""),c=200-n.length,u=n.length>=3&&n.length<=200,h=async e=>{if(e.preventDefault(),u){l(!0);try{let e=localStorage.getItem("access_token")||sessionStorage.getItem("access_token");if(!e)throw Error("Please login to post comments");if(!(await fetch("/api/v1/comments/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({content:n,parent_id:s})})).ok)throw Error("Failed to post comment");i(""),m(""),t&&t()}catch(e){m(e instanceof Error?e.message:"Failed to post comment")}finally{l(!1)}}};return(0,a.jsxs)("form",{onSubmit:h,className:"space-y-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("textarea",{value:n,onChange:e=>i(e.target.value),placeholder:"Write your comment...",className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 min-h-[100px]",maxLength:200}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsxs)("span",{className:"text-xs ".concat(c<20?"text-red-500":"text-gray-500"),children:[c," characters remaining"]}),n.length>0&&n.length<3&&(0,a.jsx)("span",{className:"text-xs text-red-500",children:"Minimum 3 characters required"})]})]}),d&&(0,a.jsx)("div",{className:"text-red-500 text-sm",children:d}),(0,a.jsx)("button",{type:"submit",disabled:!u||o,className:"inline-flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed",children:o?"Posting...":"Post Comment"})]})}function i(e){let{user:s}=e,[t,i]=(0,r.useState)([]),[o,l]=(0,r.useState)(!0),[d,m]=(0,r.useState)(""),c=async()=>{try{let e=localStorage.getItem("access_token")||sessionStorage.getItem("access_token"),s={};e&&(s.Authorization="Bearer ".concat(e));let t=await fetch("/api/v1/comments/",{headers:new Headers(s)});if(!t.ok)throw Error("Failed to fetch comments");let a=await t.json();i(a),m("")}catch(e){m(e instanceof Error?e.message:"Failed to fetch comments")}finally{l(!1)}};(0,r.useEffect)(()=>{c()},[]);let u=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(0,a.jsxs)("div",{className:"relative group transition-all duration-200 ".concat(0===s?"mb-6":"mb-4 ml-6 border-l-2 border-blue-100 pl-4"),children:[(0,a.jsx)("div",{className:"flex items-start gap-3",children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"font-semibold text-gray-800",children:e.user.username}),(0,a.jsxs)("span",{className:"text-xs text-gray-400",children:[new Date(e.created_at).toLocaleDateString(),"\xa0",new Date(e.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]}),(0,a.jsx)("p",{className:"mt-1 text-gray-700 whitespace-pre-wrap text-base leading-relaxed",children:e.content}),(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsx)(n,{parentId:e.id,onSuccess:c})})]})}),e.children&&e.children.length>0&&(0,a.jsx)("div",{className:"mt-3",children:e.children.map(e=>u(e,s+1))})]},e.id)};return(0,a.jsxs)("div",{className:"max-w-2xl mx-auto px-2 py-8",children:[s&&(0,a.jsxs)("div",{className:"mb-8 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl shadow p-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold mb-3 text-gray-800",children:"Post a Comment"}),(0,a.jsx)(n,{onSuccess:c})]}),(0,a.jsx)("div",{className:"bg-white rounded-xl shadow border border-blue-100 overflow-hidden",children:(0,a.jsx)("div",{className:"p-6",children:o?(0,a.jsx)("div",{className:"flex justify-center py-8",children:(0,a.jsxs)("div",{className:"animate-pulse flex space-x-2",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),(0,a.jsx)("div",{className:"w-2 h-2 bg-indigo-500 rounded-full"}),(0,a.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full"})]})}):d?(0,a.jsx)("div",{className:"py-8 text-center text-red-500",children:d}):t.length>0?(0,a.jsx)("div",{className:"space-y-2",children:t.map(e=>u(e))}):(0,a.jsxs)("div",{className:"py-12 text-center",children:[(0,a.jsx)("p",{className:"text-gray-500 mb-4",children:"No comments yet."}),!s&&(0,a.jsx)("p",{className:"text-sm text-gray-400",children:"Login to post a comment."})]})})})]})}var o=t(1145),l=t(9597),d=t(4274);function m(){let{user:e}=(0,d.J)(),[s,t]=(0,r.useState)(!1);return(0,a.jsxs)("div",{className:"py-8",children:[!e&&(0,a.jsx)("div",{className:"max-w-md mx-auto",children:s?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.A,{}),(0,a.jsxs)("p",{className:"mt-4 text-center text-sm",children:["Already have an account?"," ",(0,a.jsx)("button",{onClick:()=>t(!1),className:"text-indigo-600 hover:text-indigo-500 font-medium",children:"Login"})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.A,{}),(0,a.jsxs)("p",{className:"mt-4 text-center text-sm",children:["Don't have an account?"," ",(0,a.jsx)("button",{onClick:()=>t(!0),className:"text-indigo-600 hover:text-indigo-500 font-medium",children:"Register"})]})]})}),(0,a.jsxs)("div",{className:"mt-8",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Comments"}),(0,a.jsx)(i,{user:e})]})]})}},9597:(e,s,t)=>{"use strict";t.d(s,{A:()=>c});var a=t(5155),r=t(2115),n=t(5695);let i=e=>/[a-z]/.test(e),o=e=>/[A-Z]/.test(e),l=e=>/\d/.test(e),d=e=>/[^a-zA-Z0-9]/.test(e),m=e=>{for(let s=0;s<e.length;s++){let t=e.charCodeAt(s);if(!(t>47&&t<58)&&!(t>64&&t<91)&&!(t>96&&t<123))return!1}return e.length>0};function c(e){let{onSuccess:s}=e,[t,c]=(0,r.useState)({username:"",email:"",password:""}),[u,h]=(0,r.useState)({}),[x,g]=(0,r.useState)(!1),p=(0,n.useRouter)(),f=()=>{let e={};return t.username.trim()?m(t.username)?(t.username.length<5||t.username.length>20)&&(e.username="Username must be between 5-20 characters"):e.username="Username can only contain letters and numbers":e.username="Username is required",t.password?t.password.length<8||t.password.length>20?e.password="Password must be between 8-20 characters":i(t.password)&&o(t.password)&&l(t.password)&&d(t.password)||(e.password="Password must contain at least one uppercase, one lowercase, one number and one special character"):e.password="Password is required",t.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.email)||(e.email="Invalid email format"):e.email="Email is required",h(e),0===Object.keys(e).length},b=async e=>{if(e.preventDefault(),f()){g(!0);try{let e=await fetch("/api/v1/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok){let s=await e.json();throw Error(s.detail||"Registration failed")}s?s():p.push("/")}catch(e){h({submit:e instanceof Error?e.message:"Registration failed"})}finally{g(!1)}}},w=e=>{let{name:s,value:t}=e.target;c(e=>({...e,[s]:t}))};return(0,a.jsxs)("form",{onSubmit:b,className:"space-y-4",children:[u.submit&&(0,a.jsx)("div",{className:"text-red-500 text-sm",children:u.submit}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"username",className:"block text-sm font-medium",children:"Username"}),(0,a.jsx)("input",{type:"text",id:"username",name:"username",value:t.username,onChange:w,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"}),u.username&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-500",children:u.username})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium",children:"Email"}),(0,a.jsx)("input",{type:"email",id:"email",name:"email",value:t.email,onChange:w,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"}),u.email&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-500",children:u.email})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium",children:"Password"}),(0,a.jsx)("input",{type:"password",id:"password",name:"password",value:t.password,onChange:w,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"}),u.password&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-500",children:u.password})]}),(0,a.jsx)("button",{type:"submit",disabled:x,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50",children:x?"Registering...":"Register"})]})}}},e=>{var s=s=>e(e.s=s);e.O(0,[441,684,358],()=>s(4048)),_N_E=e.O()}]);